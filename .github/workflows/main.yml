name: FC RSS Updater (Playwright)

on:
  schedule:
    - cron: '0 * * * *' # 每 1 小時執行一次
  workflow_dispatch:      # 允許手動觸發

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          # 安裝 Playwright 瀏覽器引擎 (Chromium)
          playwright install chromium

      - name: Run Scraper with Playwright
        run: python scraper.py

      - name: Show generated feed counts
        run: |
          echo "----- Generated feed counts -----"
          for f in docs/*.xml; do
            if [ -f "$f" ]; then
              count=$(grep -c '<item>' "$f" || true)
              echo "FEED: $f -> $count items"
            else
              echo "FEED: $f -> (not found)"
            fi
          done
          echo "---------------------------------"

      - name: "Note: No auto-push (manual control)"
        run: |
          echo "Auto push is disabled. If you want to push updated XML, run scraper.py locally and git add/commit/push the docs/ files."